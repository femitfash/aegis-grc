# QA Assessment Report — Aegis GRC

**Date:** 2026-02-24
**Assessor:** Senior GRC QA Agent
**Scope:** Full platform assessment — all feature areas, API routes, database schema, and UI
**Methodology:** Static code analysis across all source files; GRC domain workflow evaluation

---

## Executive Summary

Aegis GRC demonstrates a well-architected, copilot-first foundation with genuinely strong AI integration, clean UX patterns, and a solid database schema. The core GRC workflow — create risk → link control → reduce residual score — is functionally correct end-to-end. However, the platform has a critical gap: the main Dashboard page displays entirely hardcoded/mock data rather than live database values, which would immediately undermine trust with any CISO or auditor evaluating the product. Several other significant issues exist around evidence management (missing expiry dates, no file uploads, no approval workflow in the UI), the controls page (no edit/delete capability from the UI), settings page data (mock-only team members and org details never actually saved), and the framework requirement data (built-in frameworks are hardcoded client-side and disconnected from the `framework_requirements` database table). The platform is approximately 70% complete toward a credible MVP — the AI copilot and risk/control management core are production-quality, but the supporting workflows need attention before a CISO would consider purchasing.

---

## Critical Issues (P0 — Blocks core workflows)

| # | Feature | Issue | Expected | Actual | File:Line |
|---|---------|-------|----------|--------|-----------|
| 1 | Dashboard | All KPI stat cards show hardcoded values (24 risks, 5 critical, 156 active controls, 78% SOC 2 readiness) | Live data queried from database | Static strings — never changes even when user has 0 risks | `src/app/(dashboard)/dashboard/page.tsx:22–48` |
| 2 | Dashboard | "Recent Risks" panel shows 4 hardcoded example risks (RISK-001 through RISK-004) | Latest risks from the actual risk register | Hardcoded mock data — misleads users and auditors | `src/app/(dashboard)/dashboard/page.tsx:81–86` |
| 3 | Dashboard | "Pending Evidence" panel shows 4 hardcoded evidence items including a fake "Vendor Risk Assessment" | Real evidence items near expiry | Hardcoded fake data | `src/app/(dashboard)/dashboard/page.tsx:96–100` |
| 4 | Dashboard | Framework compliance cards (SOC2 78%, ISO 65%, NIST 71%) are hardcoded constants | Real readiness computed from framework status overrides | Hardcoded — never updates when user marks requirements complete | `src/app/(dashboard)/dashboard/page.tsx:54–57` |
| 5 | Risk Management | No DELETE endpoint exists for risks | `DELETE /api/risks/:id` — allows users to remove risks | Only GET and the controls sub-route exist; no risk deletion API | `src/app/api/risks/route.ts` (no DELETE handler) |
| 6 | Risk Management | No UPDATE/PATCH endpoint for risks | Ability to edit risk title, description, likelihood, impact, status, treatment | No PATCH/PUT handler exists for `/api/risks` or `/api/risks/[id]` | `src/app/api/risks/route.ts` (no PATCH handler) |
| 7 | Evidence | No evidence expiry date (`valid_to`) tracked or surfaced in UI despite schema supporting it | Evidence expiry visible, items flagged as "overdue" when `valid_to` < today | `valid_to` column exists in DB but never written or displayed; `overdue` status is never assigned by any code | `src/app/api/evidence/route.ts:58–91`; `src/app/(dashboard)/dashboard/evidence/page.tsx:36–44` |
| 8 | Copilot | `get_compliance_status` tool returns hardcoded mock data, not real org data | Tool reads from the `requirement_statuses` org settings (as status/route API does) | Returns static mock percentages regardless of actual user data | `src/app/api/copilot/route.ts:453–484` |

---

## High Issues (P1 — Significant UX/functional gap)

| # | Feature | Issue | Expected | Actual | File:Line |
|---|---------|-------|----------|--------|-----------|
| 1 | Control Library | No edit or delete control from UI | Clicking a control row opens an edit form; delete button with confirmation | Row click has `cursor-pointer` but no `onClick` handler — nothing happens | `src/app/(dashboard)/dashboard/controls/page.tsx:440–499` |
| 2 | Control Library | No DELETE endpoint for controls | `DELETE /api/controls/:id` | Only GET and POST exist in `/api/controls/route.ts` | `src/app/api/controls/route.ts` |
| 3 | Control Library | No PATCH/PUT endpoint for updating controls | `PATCH /api/controls/:id` | No update endpoint exists | `src/app/api/controls/route.ts` |
| 4 | Frameworks | Built-in framework requirements (SOC2, ISO 27001, NIST CSF) are entirely hardcoded client-side; none stored in or read from `framework_requirements` DB table | Requirements read from/written to DB; `control_requirement_mappings` table used to link controls to requirements | Client-side `BUILTIN_FRAMEWORKS` constant is the source of truth; the `framework_requirements` table is seeded in schema but never queried by any API | `src/app/(dashboard)/dashboard/frameworks/page.tsx:84–177`; `docs/database-schema.sql:51–63` |
| 5 | Frameworks | Status overrides for built-in frameworks (SOC2, ISO 27001, NIST CSF) cannot be changed via copilot's `update_requirement_status` tool for users without an `organization_id`, because the tool writes to `organizations.settings` but the read path for built-in framework status also requires an org | Users without an org record can still track requirement status | API returns `{ requirement_statuses: {} }` if no org; copilot tool also requires org; new users with no org assignment cannot persist any framework changes | `src/app/api/frameworks/status/route.ts:21–23`; `src/app/api/copilot/execute/route.ts:35–59` |
| 6 | Risk Management | Linking a control to a risk auto-sets status to `"assessed"` regardless of previous status | Status lifecycle should progress forward (identified → assessed) but not regress (mitigated → assessed) | `status: "assessed"` is always written, which downgrades a "mitigated" or "accepted" risk back to "assessed" | `src/app/api/risks/[id]/controls/route.ts:97–98` |
| 7 | Risk Management | No category filter on the risk register | Filter by risk category (Security, Compliance, Operational, etc.) | Only status and text search filters exist; category shown in table but not filterable | `src/app/(dashboard)/dashboard/risks/page.tsx:463–477` |
| 8 | Evidence | No file upload capability — only URL links supported | Upload PDF/screenshot as file attachment (stored in Supabase Storage) | `file_path`, `file_hash`, `file_size_bytes`, `mime_type` columns exist in DB but no upload UI or endpoint exists | `src/app/(dashboard)/dashboard/evidence/page.tsx:120–224`; `docs/database-schema.sql:196–200` |
| 9 | Evidence | Evidence approval/rejection workflow is invisible in UI | Compliance manager reviews pending evidence: approve or reject with notes | `status` column supports `pending/approved/rejected/expired` and `reviewed_by`/`reviewed_at` exist in DB, but the UI has no approve/reject buttons — new evidence is always "pending" and stuck there | `src/app/api/evidence/route.ts:88`; `src/app/(dashboard)/dashboard/evidence/page.tsx:407–486` |
| 10 | Settings — Team | Team management is entirely mock data (hardcoded `TEAM_MEMBERS` array, "Send Invite" button with no handler) | Invite sends email; team list reads from `users` table; role changes persist | `SEND_INVITE` button has no `onClick`, members are static | `src/app/(dashboard)/dashboard/settings/page.tsx:8–25, 220` |
| 11 | Settings — Organization | Organization name and slug form fields are hardcoded to "Acme Corp"; `handleSave` is a no-op that just shows a toast | Form reads and writes to `organizations` table | Save button triggers `setSaved(true)` only — no API call; form values never read from DB | `src/app/(dashboard)/dashboard/settings/page.tsx:31–32, 74–77` |
| 12 | Auth | "Register" link on landing page/prompts page links to `/login` (not `/register`) | Clicking "Get started free" navigates to `/register` | All CTA buttons in `src/app/page.tsx` link `href="/login"` — no distinct register entry point from marketing page | `src/app/page.tsx:44, 76` |
| 13 | Audit Log | Audit log is never populated automatically — no triggers or application-layer calls to `insert_audit_log` function exist | Every create/update/delete on risks, controls, evidence, frameworks triggers an audit entry | The `insert_audit_log` stored procedure exists but no API route calls it after mutations | `src/app/api/risks/route.ts`; `src/app/api/copilot/execute/route.ts` (no audit calls anywhere) |

---

## Medium Issues (P2 — Missing sub-features, polish)

| # | Feature | Issue | Expected | Actual | File:Line |
|---|---------|-------|----------|--------|-----------|
| 1 | Risk Management | "Register Risk" button stuffs text into copilot input using raw DOM query `document.querySelector('[placeholder="Ask anything about GRC..."]')` — brittle, breaks if copilot is closed | Button opens copilot panel if closed, then focuses input | Direct DOM manipulation that silently fails if copilot panel is hidden | `src/app/(dashboard)/dashboard/risks/page.tsx:420–424` |
| 2 | Risk Management | `closed` status excluded from the status filter pill bar | All 5 statuses filterable | Filter pills only include `["all", "identified", "assessed", "mitigated", "accepted"]` — "Closed" risks can never be filtered to | `src/app/(dashboard)/dashboard/risks/page.tsx:463` |
| 3 | Risk Management | Risk table rows are wrapped in a React fragment without a `key` prop | Each fragment should have key matching `risk.dbId` | `<>` fragment wrapping `<tr>` and `<RiskControlPanel>` has no key; React will warn in dev | `src/app/(dashboard)/dashboard/risks/page.tsx:535–587` |
| 4 | Risk Management | Residual score is not recalculated after control unlink | Unlinking a control should re-run the residual score calculation | `DELETE /api/risks/[id]/controls` removes the mapping but does NOT recalculate `residual_likelihood`/`residual_impact` | `src/app/api/risks/[id]/controls/route.ts:106–130` |
| 5 | Risk Management | Risk due dates not surfaced in UI | `due_date` column in DB visible in risk list and editable | `due_date` is in the schema but `mapDbRisk()` does not map it and it is never displayed | `src/app/(dashboard)/dashboard/risks/page.tsx:77–106` |
| 6 | Control Library | `control_requirement_mappings` DB table (linking controls to framework requirements) is never queried or written by any API | Controls page shows which specific framework requirements each control satisfies | Only framework codes are stored in `metadata.frameworks` JSONB; the dedicated mapping table is unused | `src/app/api/controls/route.ts`; `docs/database-schema.sql:96–107` |
| 7 | Frameworks | "Add Framework" button uses same DOM-query hack as risks to pre-fill copilot input — breaks when copilot is hidden | Opens copilot intelligently regardless of its current state | `document.querySelector('[placeholder="Ask anything about GRC..."]')` — silently no-ops if copilot closed | `src/app/(dashboard)/dashboard/frameworks/page.tsx:358–364` |
| 8 | Frameworks | "Add Requirement" form only visible on custom frameworks — built-in frameworks (SOC2, ISO27001, NIST CSF) show no way to add requirements | Ability to add custom requirements to built-in frameworks | `isCustom` check hides the "Add Requirement" button for built-in frameworks | `src/app/(dashboard)/dashboard/frameworks/page.tsx:539–543` |
| 9 | Evidence | Evidence page fetch errors are silently swallowed — `catch {}` block sets an empty array with no error banner shown | Error banner appears like on the risks and controls pages | `try/catch` catches all fetch errors but only calls `setEvidence([])` — no `setError()` call | `src/app/(dashboard)/dashboard/evidence/page.tsx:238–249` |
| 10 | Evidence | Evidence cannot be linked directly to a framework requirement (only to a control code by free-text) | Structured link from evidence → control (FK) → requirement (FK) | Control linkage is free-text code in JSONB metadata; `control_evidence_mappings` DB table is never queried or written | `src/app/(dashboard)/dashboard/evidence/page.tsx:157–165`; `docs/database-schema.sql:229–238` |
| 11 | Integrations | Jira and Slack integration routes (`/api/integrations/jira/route.ts`, `/api/integrations/slack/route.ts`) were confirmed to exist but their logic mirrors GitHub — missing "test" action response handling on the UI when the action returns a detailed error | Integration test errors shown in full | Error messages from failing integration test are not parsed beyond `data.error` | `src/app/(dashboard)/dashboard/integrations/page.tsx:174` |
| 12 | Settings — Notifications | All notification toggles are static UI — hardcoded `defaultOn` prop; no state management; no API; toggling one doesn't change anything | Toggle state persists to backend; changes notification routing | `defaultOn` is a hardcoded prop; toggle buttons have no `onClick` handler | `src/app/(dashboard)/dashboard/settings/page.tsx:318–345` |
| 13 | Settings — Security | MFA "Enabled" badge and session timeout selector are cosmetic only — no backend connection | Org-level MFA enforcement setting persists | No `onClick` or form submission; purely decorative UI | `src/app/(dashboard)/dashboard/settings/page.tsx:355–380` |
| 14 | Settings — Integrations tab | Settings page "Integrations" tab lists different integrations (Okta, Azure Defender, AWS) with different status (jira/slack "connected") than the actual Integrations page (which reads from DB) | Consistent integration status across the application | Two separate integration lists — settings tab uses hardcoded `INTEGRATIONS` array | `src/app/(dashboard)/dashboard/settings/page.tsx:18–25` |
| 15 | Copilot | Conversation history is not persisted to DB (`copilot_conversations` table is never seeded on first use; messages are saved to `copilot_messages` but only if `conversationId` is provided and the conversation record pre-exists) | Chat history survives page refresh | Conversation history is session-only; each page load starts fresh | `src/app/api/copilot/route.ts:671–686`; `src/app/(dashboard)/dashboard/settings/page.tsx` missing conversation create |
| 16 | Copilot | The `CONVERSATION_ID` is module-level (`const CONVERSATION_ID = generateId()`) — shared across all component remounts in dev strict mode; in production it is stable per page load but resets on navigation | Conversation ID stable per user session, stored in localStorage or DB | Module-level constant resets on every full page navigation | `src/features/copilot/components/CopilotPanel.tsx:34` |
| 17 | Navigation — Layout | Copilot panel does not receive `context.page` prop from the layout — `onClose` is passed but no `context` | Copilot knows which GRC page the user is on and tailors suggestions | `CopilotPanel` is rendered in layout without a `context` prop; the contextual prompt enhancement (`contextualPrompt`) is never triggered in practice | `src/app/(dashboard)/layout.tsx:84–86`; `src/app/api/copilot/route.ts:582–584` |
| 18 | Risk Management | Risk owner is displayed as `row.owner_name` but the API GET route does not join to the `users` table to resolve names | Owner shown as user's full name | Falls back to `"Team member"` for every risk because no name resolution is done in `/api/risks/route.ts` (unlike `/api/controls/route.ts` which does resolve owner names) | `src/app/api/risks/route.ts:41–81` |
| 19 | Audit Log | Audit log API returns `total: count ?? 0` but Supabase does not return a count without `{ count: 'exact' }` option on the query | Pagination shows total record count | `count` will always be `null`; "Next" button appears on any page with exactly 50 results even if there are no more records | `src/app/api/audit-log/route.ts:43` |

---

## Low / Polish (P3 — Nice-to-have, minor)

| # | Feature | Issue | Expected | Actual | File:Line |
|---|---------|-------|----------|--------|-----------|
| 1 | Evidence | `collector` field always hardcoded to `"Team member"` | Actual collector name from `created_by` FK join | No name resolution on evidence creator | `src/app/(dashboard)/dashboard/evidence/page.tsx:62` |
| 2 | Controls | Control type taxonomy is ambiguous — 7 types offered (`technical`, `administrative`, `operational`, `physical`, `preventive`, `detective`, `corrective`) mixing two different classification schemes (by nature vs. by function) | Single consistent taxonomy (e.g., NIST style: preventive/detective/corrective) | Mixed taxonomy causes confusion and redundancy in control categorization | `src/app/(dashboard)/dashboard/controls/page.tsx:271–274` |
| 3 | Risk Management | Inherent score sorting in the API (`enriched.sort(...)`) is redundant with the client-side sort already applied in the page component | Remove server-side sort and rely on one canonical sort | Two sort operations applied sequentially; the client sort always wins | `src/app/api/risks/route.ts:76–78` |
| 4 | Marketing Page | "Get started free" and "Sign in" CTAs both link to `/login` — no distinct register flow entry from landing page | "Get started free" → `/register`; "Sign in" → `/login` | All CTAs go to `/login` | `src/app/page.tsx:44, 76–79` |
| 5 | Settings — AI Copilot | Anthropic API key stored as plaintext in `organizations.settings` JSONB | API key stored encrypted at rest (separate encrypted column or Supabase Vault) | Key stored as `{ anthropic_api_key: "sk-ant-..." }` in plain JSONB | `src/app/api/settings/copilot/route.ts:79` |
| 6 | Integration credentials | Integration `config` JSONB field stores tokens/secrets in plaintext (masked on display but stored raw) | Credentials stored via Supabase Vault or encrypted column with KMS | `config: { token: "ghp_..." }` stored unencrypted in Postgres | `docs/database-schema.sql:469`; `src/app/api/integrations/route.ts:77` |
| 7 | Copilot | Free action counter (`copilot_write_count`) is stored in `organizations.settings` JSONB — any admin who edits settings could reset it | Counter in a separate non-settings column or protected table | `settings.copilot_write_count` can be reset by anyone who can update `organizations.settings` | `src/app/api/copilot/execute/route.ts:72` |
| 8 | Copilot | `import_github_alerts` in execute route makes a fetch to itself (`fetch(new URL("/api/integrations/github", ...))`) that is then immediately discarded (`void ghRes`) before reinventing the same logic inline | Either use the provider route or inline the logic — not both | Dead code + duplicated implementation creates maintenance burden | `src/app/api/copilot/execute/route.ts:515–531` |
| 9 | Frameworks | `cycleStatus` function for requirement status badges skips `not-applicable` — clicking a "not-applicable" item cycles to `partial`, not remaining `not-applicable` | "N/A" status locked unless explicitly changed by a separate action | `STATUS_CYCLE` excludes `not-applicable`; clicking an N/A req changes it to `partial` | `src/app/(dashboard)/dashboard/frameworks/page.tsx:76–81` |
| 10 | Controls | Filter status normalization maps `draft` → `planned` but the filter button also shows "Not Started" — `not-started` in the filter never matches any real DB status | Consistent status vocabulary between DB and UI | Status vocabulary mismatch: DB has `draft/active/deprecated`; UI offers `planned/testing/implemented/not-started` | `src/app/(dashboard)/dashboard/controls/page.tsx:172–178, 373` |
| 11 | Auth | `forgot-password` and `reset-password` pages exist but there is no link to forgot-password from the `/register` page | "Already have an account? Sign in" + "Forgot password?" on register page | Register page only has `<RegisterForm />` with no forgot-password cross-link | `src/app/(auth)/register/page.tsx` |
| 12 | General | Supabase admin client is used extensively to bypass RLS, justified by a prior auth check. However, no server-side checks prevent one org's data from leaking to another org when `organizationId` is `null` — several routes fall through to `query.eq("owner_id", user.id)` | Strict organization isolation always enforced | Risk API fallback: `query.eq("owner_id", user.id)` exposes risks to users without an org, who then see all risks they "own" regardless of organization context | `src/app/api/risks/route.ts:46–51` |

---

## Missing Features (Not yet implemented)

- **Risk edit workflow**: No inline edit form or edit API endpoint for existing risks. Users cannot change a risk's title, description, likelihood/impact, or treatment after creation without going through the copilot.
- **Risk deletion**: No `DELETE /api/risks/:id` endpoint. Users cannot remove risks from the register.
- **Control edit/delete**: No `PATCH /api/controls/:id` or `DELETE /api/controls/:id`. Controls once created are immutable from the UI.
- **Evidence expiry tracking**: `valid_from`/`valid_to` columns exist in the database schema but are never written at creation time, never displayed in the UI, and no automated job marks evidence as "expired" or "overdue".
- **Evidence file upload**: The schema supports file attachments (`file_path`, `file_hash`, `file_size_bytes`, `mime_type`) but there is no file upload UI or Supabase Storage integration. Only URL links are supported.
- **Evidence approval workflow**: The UI has no mechanism for a compliance manager to review, approve, or reject pending evidence. The `reviewed_by`/`reviewed_at` fields are unused.
- **Control-to-requirement linking**: The `control_requirement_mappings` table is designed but never used by any API. Users cannot formally link a control to a specific framework requirement from the UI (only informal `metadata.frameworks` tags).
- **Assessment/audit tracking**: The `assessments` and `assessment_findings` tables are defined in the schema but there is no page, API route, or copilot tool for creating or managing assessments. The "auditor portal" referenced in CLAUDE.md and the architecture does not exist.
- **Team management**: Team invitation, role assignment, and member removal are all mock UI with no backend wiring. The `users.role` and `users.permissions` fields are never updated from the app.
- **Risk owner assignment UI**: Risk owners can only be set as the creating user. There is no UI to reassign ownership to another team member.
- **Risk appetite / risk tolerance configuration**: `risk_appetite` column in schema is never used.
- **Notification system**: All notification toggles in Settings are decorative. No email, Slack, or in-app notification system is implemented.
- **Password change from settings**: No "Change password" option exists in the Security settings tab.
- **Automated compliance scoring from real DB requirements**: The `framework_requirements` table is seeded but never queried. The compliance readiness % is computed from client-side hardcoded data.
- **Integration sync scheduling**: `sync_frequency_minutes` and `integration_sync_logs` table exist but no scheduled/cron sync is implemented. All imports are manual.
- **Export/reporting**: No PDF, CSV, or SOC 2 readiness report export capability.
- **Risk heat map / matrix view**: Standard GRC tooling; no visual 5x5 risk matrix.

---

## What's Working Well

- **Copilot architecture**: The agentic loop with read/write tool separation, user approval cards, and per-action execution is well-designed and production-quality. The tool definitions are comprehensive and GRC-appropriate.
- **BYOK / free tier enforcement**: The 10-action free limit and BYOK API key flow is correctly implemented end-to-end across the copilot and settings UI.
- **Risk-control linking and residual score calculation**: The core GRC workflow — link a control → automatically recalculate residual likelihood and impact using weighted effectiveness — is correctly implemented and correctly wired up in both the UI expand panel and the copilot execute route.
- **Database schema**: Well-designed relational schema with proper foreign keys, RLS enablement, a cryptographic audit log hash chain function, and appropriate JSONB fields for flexible metadata.
- **Audit log**: The hash chain implementation (SHA-512, `previous_hash` linking, immutability triggers) is correct and auditor-grade. The UI for viewing it is clean and shows hash values.
- **Integration security**: The `maskConfig()` function in `/api/integrations/route.ts` correctly masks sensitive keys before returning to the client. Admin-only enforcement on integration write operations is correct.
- **Evidence page UX**: The create dialog, status filters, framework filters, and search are all well-implemented. The empty state is actionable with both manual and copilot paths.
- **Framework UI**: Requirement status cycling (click to advance Not Started → Partial → Implemented) with optimistic updates and rollback on failure is a good UX pattern.
- **Custom framework support**: Custom frameworks can be added via copilot or the "Add Framework" flow, with requirements stored in `organizations.settings`, and the custom vs built-in branching is handled correctly.
- **Auth flows**: Login, register, forgot-password, and reset-password are all implemented with proper loading states, error messages, and success redirects.
- **Prompt library**: The prompts page is polished, publicly accessible, categorized, searchable, and reinforces the copilot-first value proposition effectively.
- **GitHub Dependabot import**: The full alert import flow — fetch from GitHub API, severity scoring, deduplication by `metadata->>github_alert_number`, risk creation — is correctly implemented.
- **Error handling pattern**: Most API routes return structured `{ error, detail }` JSON with appropriate HTTP status codes. The risks and controls pages show orange error banners to users.
- **Dark mode**: Theme toggle with system/light/dark options is correctly implemented using `localStorage`.
- **Responsive sidebar layout**: Navigation, main content area, and copilot panel are cleanly structured.

---

## Prioritised Fix List for Developer

### P0 — Must fix before any external demo or evaluation

1. **[P0] Dashboard: Replace all hardcoded stat cards, recent risks, and evidence with live API calls** — Create `/api/dashboard/stats`, `/api/risks?limit=4`, `/api/evidence?limit=4` calls or reuse existing endpoints; render loading states. Without this, every CISO demo shows fake data.
   - Files: `src/app/(dashboard)/dashboard/page.tsx:22–103`

2. **[P0] Risk Management: Add `PATCH /api/risks/:id` endpoint** — Support updating `title`, `description`, `inherent_likelihood`, `inherent_impact`, `status`, `risk_response`, `due_date`. Add inline edit UI to the risk row expand panel.
   - Files: Need new `src/app/api/risks/[id]/route.ts`

3. **[P0] Risk Management: Add `DELETE /api/risks/:id` endpoint** — Add delete confirmation to the risk row expand panel.
   - Files: Need new `src/app/api/risks/[id]/route.ts`

4. **[P0] Copilot: Replace hardcoded mock data in `get_compliance_status` with real org data** — Read from `organizations.settings.requirement_statuses` and compute readiness from the built-in framework definitions using the same logic as `computeStats()` in the frameworks page.
   - File: `src/app/api/copilot/route.ts:453–484`

5. **[P0] Evidence: Set `valid_to` date at creation time and mark items as `overdue` status** — Add an expiry date field to the create dialog; write `valid_to` to the DB; add a server-side or client-side check to mark evidence as `stale`/`overdue` based on `valid_to < today`. This is a core GRC workflow.
   - Files: `src/app/(dashboard)/dashboard/evidence/page.tsx:80–225`; `src/app/api/evidence/route.ts`

6. **[P0] Controls: Add `PATCH /api/controls/:id` and `DELETE /api/controls/:id` endpoints** — Wire up an edit panel similar to the risk control panel; add a delete button with confirmation.
   - Files: Need new `src/app/api/controls/[id]/route.ts`; `src/app/(dashboard)/dashboard/controls/page.tsx`

7. **[P0] Audit Log: Call `insert_audit_log()` after every mutation** — Add audit log calls in all write paths: `create_risk`, `create_control`, `create_evidence`, `link_risk_to_control`, `update_requirement_status`, `create_framework`. Without this the "immutable audit trail" differentiator is non-functional.
   - Files: `src/app/api/copilot/execute/route.ts` (all cases); `src/app/api/controls/route.ts`; `src/app/api/evidence/route.ts`

### P1 — Must fix before launch

8. **[P1] Dashboard: Wire Framework Compliance cards to real data** — Call `/api/frameworks` and `/api/frameworks/status` then compute `readiness` using `computeStats()` logic; display actual values.
   - File: `src/app/(dashboard)/dashboard/page.tsx:53–57`

9. **[P1] Risk Management: Fix control-unlink to recalculate residual score** — After DELETE in `/api/risks/[id]/controls`, re-fetch remaining mappings and recalculate `residual_likelihood`, `residual_impact`. If no controls remain, set both to `NULL`.
   - File: `src/app/api/risks/[id]/controls/route.ts:106–130`

10. **[P1] Risk Management: Prevent status regression when linking a control** — Only set `status = "assessed"` if current status is `"identified"`; otherwise leave status unchanged.
    - File: `src/app/api/risks/[id]/controls/route.ts:97–98`

11. **[P1] Settings — Organization: Wire save to API** — Create `PATCH /api/settings/organization` endpoint; read current values from the `organizations` table on load; persist changes on save.
    - File: `src/app/(dashboard)/dashboard/settings/page.tsx:74–77`

12. **[P1] Auth: Fix "Get started free" CTAs to link to `/register`** — Update `href` on all landing page CTA buttons.
    - File: `src/app/page.tsx:44, 77`

13. **[P1] Evidence: Add approve/reject buttons to evidence list** — Add `PATCH /api/evidence/:id` to update `status`, `reviewed_by`, `reviewed_at`. Show Approve/Reject buttons for users with admin/compliance manager role.
    - Files: `src/app/(dashboard)/dashboard/evidence/page.tsx`; need `src/app/api/evidence/[id]/route.ts`

14. **[P1] Evidence: Show error banner on fetch failure** — Add `setError` state and an error banner component; remove silent `catch {}`.
    - File: `src/app/(dashboard)/dashboard/evidence/page.tsx:238–249`

15. **[P1] Risk Management: Resolve owner name in risks GET** — Join to `users` table to resolve `owner_id` → `full_name` in the same pattern as the controls API.
    - File: `src/app/api/risks/route.ts:41–81`

16. **[P1] Copilot: Pass `context` prop to `CopilotPanel` from layout** — Derive current page from `usePathname()` and pass as `context={{ page: pathname }}` to enable contextual suggestions.
    - File: `src/app/(dashboard)/layout.tsx:84–86`

17. **[P1] Controls: Fix row click to open edit panel** — Add `onClick={() => setSelectedControl(control)}` to each row; render an edit slide-over or inline panel.
    - File: `src/app/(dashboard)/dashboard/controls/page.tsx:440–499`

18. **[P1] Risk Management: Add "Closed" to status filter pills**
    - File: `src/app/(dashboard)/dashboard/risks/page.tsx:463`

19. **[P1] Risk Management: Add key to fragment wrapper around risk rows** — Fix missing React key on `<>` fragment to suppress warnings and ensure correct list reconciliation.
    - File: `src/app/(dashboard)/dashboard/risks/page.tsx:535`

20. **[P1] Security: Encrypt integration credentials and API keys** — Use Supabase Vault (`vault.create_secret()`) or a separate encrypted column instead of storing tokens in plain JSONB. This is a security-critical issue for a GRC product.
    - Files: `src/app/api/settings/copilot/route.ts:79`; `src/app/api/integrations/route.ts`

21. **[P1] Copilot: Fix dead code in `import_github_alerts`** — Remove the unused `fetch(new URL(...))` call that is immediately voided; keep only the inline GitHub API logic.
    - File: `src/app/api/copilot/execute/route.ts:515–531`

### P2 — Address before public release

22. **[P2] Settings — Team: Wire invite and team management to backend** — Implement `POST /api/settings/team/invite` (trigger Supabase auth invite email); `GET /api/settings/team` (query `users` table); `PATCH /api/settings/team/:userId` (update role).

23. **[P2] Settings — Notifications: Implement notification preference persistence** — Add `PATCH /api/settings/notifications`; store in `organizations.settings`; toggle state reads from DB.

24. **[P2] Frameworks: Query `framework_requirements` table for built-in frameworks** — Migrate the hardcoded `BUILTIN_FRAMEWORKS` client-side constants to be seeded in the DB and fetched via an enriched `/api/frameworks` response that includes requirements.

25. **[P2] Evidence: Implement file upload** — Add a file upload input to the create dialog; use Supabase Storage; write `file_path`, `file_hash`, `file_size_bytes`, `mime_type` to DB.

26. **[P2] Controls: Replace free-text framework comma entry** — Show a multi-select dropdown of known frameworks and any custom frameworks the org has added.

27. **[P2] Risk Management: Add `due_date` field** — Display and allow editing of `due_date` on risk detail panel; highlight overdue risks.

28. **[P2] Audit Log: Add `count: 'exact'`** — Fix the count query so pagination displays correct totals.
    - File: `src/app/api/audit-log/route.ts:43`

29. **[P2] Copilot: Persist conversation ID** — Store `CONVERSATION_ID` in `localStorage` or create a `copilot_conversations` record on first message; retrieve on subsequent loads to restore history.

---

*Report generated by Senior GRC QA Agent · Aegis platform assessment · 2026-02-24*
